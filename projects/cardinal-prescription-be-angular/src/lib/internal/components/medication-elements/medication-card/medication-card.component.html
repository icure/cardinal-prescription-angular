<div
  [class.focused]="focused"
  [class.isExpanded]="isExpanded"
  [class.readOnly]="readOnly"
  [id]="index"
  class="medicationRow">
  <div class="header">
    <div
      class="header__medication"
      (click)="!readOnly && handleMedicationClick()"
      [tabindex]="readOnly ? -1 : 0">
      <div class="header__medication__content">
        <div class="header__medication__content__heading">
          <div class="header__medication__content__heading__title">
            <!-- Choose the appropriate icon based on the drug type: medications,molecules, non-medicinal products -->
            <ng-container *ngIf="!!medication.ampId; else checkVmpGroup">
              <cardinal-tooltip
                [iconSnippet]="medicationIcn"
                content="{{ t('medication.drugType.medication') }}" />
            </ng-container>

            <ng-template #checkVmpGroup>
              <ng-container *ngIf="!!medication.vmpGroupId; else checkNmp">
                <cardinal-tooltip
                  [iconSnippet]="moleculeIcn"
                  content="{{ t('medication.drugType.molecule') }}" />
              </ng-container>
            </ng-template>

            <ng-template #checkNmp>
              <ng-container *ngIf="!!medication.nmpId">
                <cardinal-tooltip
                  [iconSnippet]="naturalIcn"
                  content="{{ t('medication.drugType.homologation') }}" />
              </ng-container>
            </ng-template>

            <!-- Templates for icons -->
            <ng-template #medicationIcn>
              <cardinal-solid-pill-icn [color]="'#3D87C5'" />
            </ng-template>

            <ng-template #moleculeIcn>
              <cardinal-molecule-icn [color]="'#EFAC2F'" />
            </ng-template>

            <ng-template #naturalIcn>
              <cardinal-leaf-icn [color]="'#197437'" />
            </ng-template>

            <h3>{{ medication.title }}</h3>
            <cardinal-medication-infographics [medication]="medication" />
          </div>

          <p class="header__medication__content__heading__activeIngredient">
            {{ medication.activeIngredient }}
          </p>
        </div>

        <div class="header__medication__content__description">
          <div
            class="header__medication__content__description__item price"
            *ngIf="medication.price">
            <span>
              {{ t('medication.ui.price') }}
            </span>
            <p>{{ medication.price }}</p>
          </div>

          <div
            *ngIf="medication.price"
            class="header__medication__content__description__item price">
            <span>
              {{ t('medication.reimbursement.title') }}
            </span>
            <div *ngIf="reimbursement; else noReimbursement">
              <cardinal-text-to-icon
                [text]="reimbursement.reimbursementCriterion?.category || ''"
                color="green" />
            </div>
            <ng-template #noReimbursement>
              <cardinal-text-to-icon
                [text]="t('medication.reimbursement.non')"
                color="gray" />
            </ng-template>
          </div>

          <div class="header__medication__content__description__item">
            <span>{{ t('medication.delivery.title') }}</span>
            <div *ngIf="medication.deliveryModusCode; else freeOfPrescription">
              <cardinal-text-to-icon
                [text]="medication.deliveryModusCode"
                color="orange" />
            </div>
            <ng-template #freeOfPrescription>
              <cardinal-text-to-icon
                [text]="t('medication.prescription.free')"
                color="green" />
            </ng-template>
          </div>

          <div class="header__medication__content__description__item">
            <span>
              {{ t('medication.prescription.title') }}
            </span>
            <div
              *ngIf="
                medication.deliveryModusSpecificationCode &&
                  medication.deliveryModusSpecification;
                else notApplicable
              ">
              <cardinal-text-to-icon
                [text]="medication.deliveryModusSpecificationCode"
                color="red" />
            </div>
            <ng-template #notApplicable>
              <cardinal-text-to-icon
                [text]="t('medication.delivery.notApplicable')"
                color="green" />
            </ng-template>
          </div>
        </div>
      </div>
    </div>
    <button
      *ngIf="!readOnly"
      class="header__arrow"
      [class.isExpanded]="isExpanded"
      (click)="toggleMedicationDetails()">
      <cardinal-chevron-icn color="#3D87C5" />
    </button>
  </div>

  <div *ngIf="isExpanded && !readOnly" class="content">
    <div *ngIf="medication.vmp" class="content__vmp">
      <div *ngIf="vmpName" class="content__vmp__item">
        <span>
          {{ t('medication.vmp.label') }}
        </span>
        <p>{{ vmpName }}</p>
      </div>
      <div *ngIf="vmpGroupName" class="content__vmp__item">
        <span>
          {{ t('medication.vmp.groupLabel') }}
        </span>
        <p>{{ vmpGroupName }}</p>
      </div>
    </div>

    <div class="content__divider" *ngIf="showLinks"></div>

    <div class="content__links" *ngIf="showLinks">
      <a *ngIf="medication.crmLink" [href]="medication.crmLink" target="_blank">
        {{ t('medication.links.cbip') }}
      </a>
      <a
        *ngIf="medication.patientInformationLeafletLink"
        [href]="medication.patientInformationLeafletLink"
        target="_blank">
        {{ t('medication.links.leaflet') }}
      </a>
      <a
        *ngIf="medication.rmaProfessionalLink"
        [href]="medication.rmaProfessionalLink"
        target="_blank">
        {{ t('medication.links.rma') }}
      </a>
      <a *ngIf="medication.spcLink" [href]="medication.spcLink" target="_blank">
        {{ t('medication.links.spc') }}
      </a>
      <a
        *ngIf="medication.dhpcLink"
        [href]="medication.dhpcLink"
        target="_blank">
        {{ t('medication.links.dhpc') }}
      </a>
    </div>

    <div class="content__divider" *ngIf="medication.price"></div>
    <div *ngIf="medication.price">
      <ng-container
        *ngTemplateOutlet="
          infographicsComponent?.cheapMedicationContent || null
        "></ng-container>
    </div>

    <div class="content__divider" *ngIf="reimbursement"></div>
    <div *ngIf="reimbursement">
      <ng-container
        *ngTemplateOutlet="
          infographicsComponent?.reimbursementsContent || null
        "></ng-container>
    </div>

    <div class="content__divider"></div>
    <ng-container
      *ngTemplateOutlet="
        infographicsComponent?.prescriptionConditionsContent || null
      "></ng-container>

    <div class="content__divider"></div>
    <ng-container
      *ngTemplateOutlet="
        infographicsComponent?.deliveryConditionsContent || null
      "></ng-container>

    <div *ngIf="medication.supplyProblems" class="content__divider"></div>
    <div *ngIf="medication.supplyProblems">
      <ng-container
        *ngTemplateOutlet="
          infographicsComponent?.supplyProblemsContent || null
        "></ng-container>
    </div>

    <div
      *ngIf="commercialization?.endOfComercialization"
      class="content__divider"></div>
    <div *ngIf="commercialization?.endOfComercialization">
      <ng-container
        *ngTemplateOutlet="
          infographicsComponent?.endOfCommercialisationContent || null
        "></ng-container>
    </div>

    <div
      *ngIf="commercialization && !commercialization.endOfComercialization"
      class="content__divider"></div>
    <div *ngIf="commercialization && !commercialization.endOfComercialization">
      <ng-container
        *ngTemplateOutlet="
          infographicsComponent?.startOfCommercialisationContent || null
        "></ng-container>
    </div>
  </div>
</div>
